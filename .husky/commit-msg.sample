#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

commit_msg_file=$1
commit_msg=$(cat $1)
second_line=$(echo "$commit_msg" | sed -n '2p')
description=$(echo "$commit_msg" | sed -n '3p')

# header - regex
isLengthUnder50='^(.{1,50}$)'
hasTypeEnum='(\[Daily]|\[Meeting])'
isTitleUnder20Length='.{1,20} \/'
isLevelValid=' (level) (1|2|3|4|5) \/'
isTimeVaild='.{0,5}?[sm]$'

# header
if ! grep -qP "$isLengthUnder50" "$commit_msg_file"; then
    echo "ğŸš¨ HeaderëŠ” 50ìë¥¼ ë„˜ì„ ìˆ˜ ì—†ì–´ìš”."
    echo "$commit_msg"
    echo "$second_line"
    exit 1
fi

if ! grep -qP "$hasTypeEnum" "$commit_msg_file"; then
    echo "ğŸš¨ Commit Typeì€ Daily ë˜ëŠ” Meeting ì´ì—¬ì•¼ í•´ìš”."
    echo "$commit_msg"
    echo "$second_line"
    exit 1
fi

if ! grep -qP "${hasTypeEnum}${isTitleUnder20Length}" "$commit_msg_file"; then
    echo "ğŸš¨ ë¬¸ì œ ì œëª©ì€ 20ì ì´í•˜ ì—¬ì•¼ í•´ìš”."
    echo "$commit_msg"
    echo "$second_line"
    exit 1
fi

if ! grep -qP "${hasTypeEnum}${isTitleUnder20Length}${isLevelValid}" "$commit_msg_file"; then
    echo "ğŸš¨ level + (1|2|3|4|5) í˜•ì‹ìœ¼ë¡œ ì…ë ¥ í•´ ì£¼ì„¸ìš”."
    echo "$commit_msg"
    echo "$second_line"
    exit 1
fi

if ! grep -qP "${hasTypeEnum}${isTitleUnder20Length}${isLevelValid}${isTimeVaild}" "$commit_msg_file"; then
    echo "ğŸš¨ íš¨íœ¼ì„± ì‹œê°„ì€ ì´ 4ìë¦¬ê¹Œì§€, ê·¸ë¦¬ê³  ì´ˆ ë˜ëŠ” ë¶„ì„ ë‚˜íƒ€ë‚´ëŠ” (s|m) ì´ í¬í•¨ë˜ì–´ì•¼ í•´ìš”. ex) 0.06s"
    echo "$commit_msg"
    echo "$second_line"
    exit 1
fi

# description
if ! [ -z "$second_line" ]; then
  echo "ğŸš¨ ë‘ë²ˆì§¸ ì¤„ì€ ë¹„ì›Œë‘¬ì•¼ í•´ìš”."
  echo "$commit_msg"
  exit 1
fi

if [ -z "$description" ]; then
  echo "ğŸš¨ ì„¤ëª…ì— ë¬¸ì œURLì„ ì‘ì„±í•´ì£¼ì„¸ìš”."
  echo "$commit_msg"
  exit 1
fi

